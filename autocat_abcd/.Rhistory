source("C:/Users/cvzad/Downloads/OneDrive_1_17-1-2025/7.Double_sequencial_interaction.R")
library(OncoSimulR)
df7 <- data.frame(parent = c("Root", "SS",  "SS", "SR", "RS"),
child = c("SS", "SR","RS", "RR", "RR"),
s = c(0.1, rep(0,4)),
sh = 0,
typeDep = "SM")
af7 <- allFitnessEffects(rT = df7)
gt7 <- evalAllGenotypes(af7, addwt = TRUE)
# Adaptamos los datos del data frame obtenido previamente para poder hacerlo dependiente de
# frecuencia, ya que esto es una condición para poder aplicar la intervención
rT7<- gt7
rT7 <- rT7[c(1,5,10,11,13,14),] # Genotipos que nos interesan, ya que el resto no
# generarán apenas células y se introducirán en la
# leyenda del plot de genotipos en función del tiempo
# lo cual puede dificultar su visualización
colnames(rT7)[2] <- "Fitness"
rT7[1, 2] <- "1 + n_*0" # Para que sea dependiente de frecuencia
rT7 <- allFitnessEffects(genotFitness = rT7,
frequencyDependentFitness = TRUE,
frequencyType = "abs")
# Definición de la Intervención No Adaptativa, con dos tratamientos y dos efectos
# de los fármacos sobre la población sensible. El valor se ha obtenido del artículo
userVars7 <- list(list(Name = "treatment_SR_drug1", # Tratamiento al que serán sensibles la
# población SR y la SS
Value = 0),
list(Name = "drug_1_effect",
Value = 0.2),
list(Name = "treatment_RS_drug2", # Tratamiento al que serán sensibles la
# población RS y la SS
Value = 0),
list(Name = "drug_2_effect",
Value = 0.2))
userVars7 <- createUserVars(userVars7)
# Para el tratamiento, elegimos dos periodos de tiempo de forma arbitraria en los
# cuales se van a desarrollar los tratamientos. Cabe destacar que tal y como están
# planteados posteriormente no sería necesario incluir la condición de stop, ya que
# cada tratamiento tendrá 2 repeticiones, pero se hizo así con el fin de que fuese
# fácilmente adaptable a otros casos, como, por ejemplo, la terapia adaptativa.
rules7 <-  list(list(ID = "start_SR",
Condition = "T > 100",
Action = "treatment_SR_drug1 = 1"),
list(ID = "stop_SR",
Condition = "T > 200",
Action = "treatment_SR_drug1 = 0"),
list(ID = "start_RS",     #
Condition = "T > 250",
Action = "treatment_RS_drug2 = 1"),
list(ID = "stop_RS",
Condition = "T > 350",
Action = "treatment_RS_drug2 = 0"))
rules7 <- createRules(rules7, rT7)
intervention7 <- list(list(ID = "t_SS_1",
Trigger = "treatment_SR_drug1 == 1",
WhatHappens = "n_SS = drug_1_effect * n_SS", #SS
Repetitions = 2,
Periodicity = 10),
list(ID = "t_SR_1",
Trigger = "treatment_SR_drug1 == 1",
WhatHappens = 'n_3_4 = drug_1_effect * n_3_4', #SR
Repetitions = 2,
Periodicity = 10),
list(ID = "t_SS_2",
Trigger = "treatment_RS_drug2 == 1",
WhatHappens = "n_SS = drug_2_effect * n_SS", #SS
Repetitions = 2,
Periodicity = 10),
list(ID = "t_RS_2",
Trigger = "treatment_RS_drug2 == 1",
WhatHappens = "n_2_4 = drug_2_effect * n_2_4", #RS
Repetitions = 2,
Periodicity = 10))
interventions7 <- createInterventions(intervention7, rT7)
# Simulación con la intervención
set.seed(1)
simul7 <- oncoSimulIndiv(rT7,
model = "McFLD",
onlyCancer = FALSE,
finalTime = 350,
mu = 1e-4,
initSize = c(10000, 100, 10, 10, 1),
initMutant = c("WT", "SS", "SR, SS", "RS, SS", "RR, RS, SS"),
keepPhylog = TRUE,
seed = 1,
errorHitMaxTries = FALSE,
errorHitWallTime = FALSE,
keepEvery = 0.1,
userVars = userVars7,
rules = rules7,
interventions = interventions7)
plot(simul7, show = "genotypes", type = "line", main = "DOUBLE SEQUENTIAL INTERACTION")
plot(simul7, show = "genotypes")
df8 <- data.frame(parent = c("Root", "SS",  "SS", "SS"),
child = c("SS", "SR","RS", "RR"),
s = c(0.1, rep(0,3)),
sh = -Inf,
typeDep = "MN")
af8 <- allFitnessEffects(rT = df8)
(gt8 <- evalAllGenotypes(af8, addwt = TRUE))
# Adaptamos los datos para poder hacerlos dependientes de frecuencia
rT8<- gt8
rT8 <- rT8[c(1,5,8,10,11),] # Igual que en el código anterior, seleccionamos genotipos
# que nos interesan
colnames(rT8)[2] <- "Fitness"
rT8[1, 2] <- "1 + n_*0"
rT8 <- allFitnessEffects(genotFitness = rT8,
frequencyDependentFitness = TRUE,
frequencyType = "abs")
# Definición de la Intervención No Adaptativa, de la misma forma que en el caso anterior
userVars8 <- list(list(Name = "treatment_SR_drug1",
Value = 0),
list(Name = "drug_1_effect",
Value = 0.2),
list(Name = "treatment_RS_drug2",
Value = 0),
list(Name = "drug_2_effect",
Value = 0.2))
userVars8 <- createUserVars(userVars8)
rules8 <-  list(list(ID = "start_SR",     #
Condition = "T > 100",
Action = "treatment_SR_drug1 = 1"),
list(ID = "stop_SR",
Condition = "T > 200",
Action = "treatment_SR_drug1 = 0"),
list(ID = "start_RS",     #
Condition = "T > 250",
Action = "treatment_RS_drug2 = 1"),
list(ID = "stop_RS",
Condition = "T > 350",
Action = "treatment_RS_drug2 = 0"))
rules8 <- createRules(rules8, rT8)
intervention8 <- list(list(ID = "t_SS_1",
Trigger = "treatment_SR_drug1 == 1",
WhatHappens = "n_SS = drug_1_effect * n_SS", #SS
Repetitions = 2,
Periodicity = 10),
list(ID = "t_SR_1",
Trigger = "treatment_SR_drug1 == 1",
WhatHappens = 'n_3_4 = drug_1_effect * n_3_4', #SR
Repetitions = 2,
Periodicity = 10),
list(ID = "t_SS_2",
Trigger = "treatment_RS_drug2 == 1",
WhatHappens = "n_SS = drug_2_effect * n_SS", #SS
Repetitions = 2,
Periodicity = 10),
list(ID = "t_RS_2",
Trigger = "treatment_RS_drug2 == 1",
WhatHappens = "n_2_4 = drug_2_effect * n_2_4", #RS
Repetitions = 2,
Periodicity = 10))
interventions8 <- createInterventions(intervention8, rT8)
# Simulación con la intervención
set.seed(1)
simul8 <- oncoSimulIndiv(rT8,
model = "McFLD",
onlyCancer = FALSE,
finalTime = 350,
mu = 1e-4,
initSize = c(10000, 100, 10, 10, 10),
initMutant = c("WT", "SS", "SR, SS", "RS, SS", "RR, SS"),
keepPhylog = FALSE,
seed = 1,
errorHitMaxTries = FALSE,
errorHitWallTime = FALSE,
keepEvery = 0.1,
userVars = userVars8,
rules = rules8,
interventions = interventions8)
plot(simul8, show = "genotypes", type = "line", main= "DOUBLE DIRECT INTERACTION")
if (!require(remotes)) { install.packages("remotes") }
remotes::install_github("fbreitwieser/pavian")
install.packages("ggpicrust2")
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("SQMtools")
BiocManager::install("ggpicrust2")
BiocManager::install("dada2")
BiocManager::install("phyloseq")
BiocManager::install("DESeq2")
install.packages("agricolae")
install.packages("readr")
install.packages("hrbrthemes")
install.packages("plotly")
# Install packages
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("SpikeInSubset")
a# Load libraries
# Load libraries
library(SpikeInSubset)
library(genefilter)
library(dplyr)
library(limma)
BiocManager::install("limma")
# Define variables
data(rma95)
fac <- factor(rep(1:2,each=3))
rtt <- rowttests(exprs(rma95),fac)
dim(exprs(rma95))
pData(rma95)
mask <- with(rtt, abs(dm) < .2 & p.value < .01)
spike <- rownames(rma95) %in% colnames(pData(rma95))
cols <- ifelse(mask,"red",ifelse(spike,"dodgerblue","black"))
# Plot dataset
with(rtt, plot(-dm, -log10(p.value), cex=.8, pch=16,
xlim=c(-1,1), ylim=c(0,5),
xlab="difference in means",
col=cols))
abline(h=2,v=c(-.2,.2), lty=2)
# variability of red dots
rtt$s <- apply(exprs(rma95), 1, function(row) sqrt(.5 * (var(row[1:3]) + var(row[4:6]))))
with(rtt, plot(s, -log10(p.value), cex=.8, pch=16,
log="x",xlab="estimate of standard deviation",
col=cols))
# limma
fit <- lmFit(rma95, design=model.matrix(~ fac))
colnames(coef(fit))
fit <- eBayes(fit)
tt <- topTable(fit, coef=2)
tt
# limma
fit <- lmFit(rma95, design=model.matrix(~ fac))
colnames(coef(fit))
fit <- eBayes(fit) # shrinkage
tt <- topTable(fit, coef=2)
tt
# limma
fit <- lmFit(rma95, design=model.matrix(~ fac))
# limma
fit <- lmFit(rma95, design=model.matrix(~ fac))
library(SpikeInSubset)
library(genefilter)
library(dplyr)
library(limma)
library(SpikeInSubset)
library(genefilter)
library(dplyr)
library(limma)
# Define variables
data(rma95)
fac <- factor(rep(1:2,each=3))
rtt <- rowttests(exprs(rma95),fac)
dim(exprs(rma95))
pData(rma95)
mask <- with(rtt, abs(dm) < .2 & p.value < .01)
spike <- rownames(rma95) %in% colnames(pData(rma95))
cols <- ifelse(mask,"red",ifelse(spike,"dodgerblue","black"))
# Plot dataset
with(rtt, plot(-dm, -log10(p.value), cex=.8, pch=16,
xlim=c(-1,1), ylim=c(0,5),
xlab="difference in means",
col=cols))
abline(h=2,v=c(-.2,.2), lty=2)
# variability of red dots
rtt$s <- apply(exprs(rma95), 1, function(row) sqrt(.5 * (var(row[1:3]) + var(row[4:6]))))
with(rtt, plot(s, -log10(p.value), cex=.8, pch=16,
log="x",xlab="estimate of standard deviation",
col=cols))
# limma
fit <- lmFit(rma95, design=model.matrix(~ fac))
colnames(coef(fit))
fit <- eBayes(fit) # shrinkage
tt <- topTable(fit, coef=2)
tt
# compare limma results with previous
limmares <- data.frame(dm=coef(fit)[,"fac2"], p.value=fit$p.value[,"fac2"])
with(limmares, plot(dm, -log10(p.value),cex=.8, pch=16,
col=cols,xlab="difference in means",
xlim=c(-1,1), ylim=c(0,5)))
abline(h=2,v=c(-.2,.2), lty=2)
n <- 40
qs <- seq(from=0,to=.2,length=n)
idx <- sapply(seq_len(n),function(i) which(as.integer(cut(rtt$s^2,qs)) == i)[1])
idx <- idx[!is.na(idx)]
par(mar=c(5,5,2,2))
plot(1,1,xlim=c(0,.21),ylim=c(0,1),type="n",
xlab="variance estimates",ylab="",yaxt="n")
axis(2,at=c(.1,.9),c("before","after"),las=2)
segments((rtt$s^2)[idx],rep(.1,n),
fit$s2.post[idx],rep(.9,n))
setwd("~/all_obs/master/tfm/catalytic_world/autocat_abcd")
# 1. Load the data
df <- read.csv("protocell_sim.csv")
# 1. Load the data
df <- read.csv("protocell_sim_prueba.csv")
# 2. Fit the linear model (Growth Rate alpha)
# We model log_volume as a function of time
myAdditive <- lm(log_volume ~ time, data = df)
# 3. View the summary (Alpha, R^2, and p-values)
summary(myAdditive)
# 4. The "Magic" Diagnostics
# This creates the 2x2 grid you remember
oldpar <- par(oma=c(0,0,3,0), mfrow=c(2,2))
plot(myAdditive)
# Add a main title to the outer margin
mtext("Gillespie Simulation: Linear Model Diagnostics", outer=TRUE, cex=1.5)
par(oldpar)
par(oldpar)
plot(myAdditive)
oldpar <- par(oma=c(0,0,3,0), mfrow=c(2,2))
plot(myAdditive)
# Add a main title to the outer margin
mtext("Gillespie Simulation: Linear Model Diagnostics", outer=TRUE, cex=1.5)
par(oldpar)
?mtext
oldpar <- par(oma=c(0,0,3,0), mfrow=c(2,2))
plot(myAdditive)
# Add a main title to the outer margin
mtext("Gillespie Simulation: Linear Model Diagnostics", cex=1.5)
par(oldpar)
oldpar <- par(oma=c(0,0,3,0), mfrow=c(2,2))
plot(myAdditive)
# Add a main title to the outer margin
par(oldpar)
library(moments)
install.packages("moments")
library(moments)
kurtosis(residuals(myAdditive))
# 1. Load the data
df <- read.csv("protocell_sim_prueba2.csv")
myAdditive <- lm(log_volume ~ time, data = df)
# 3. View the summary (Alpha, R^2, and p-values)
summary(myAdditive)
# 4. The "Magic" Diagnostics
# This creates the 2x2 grid you remember
oldpar <- par(oma=c(0,0,3,0), mfrow=c(2,2))
plot(myAdditive)
# Add a main title to the outer margin
par(oldpar)
library(moments)
kurtosis(residuals(myAdditive))
plot(time, volume)
plot(data$time, data$volume)
plot(volume ~ time, data= df)
myAdditive <- lm(volume ~ time, data = df)
# 3. View the summary (Alpha, R^2, and p-values)
summary(myAdditive)
# 4. The "Magic" Diagnostics
# This creates the 2x2 grid you remember
oldpar <- par(oma=c(0,0,3,0), mfrow=c(2,2))
plot(myAdditive)
# Add a main title to the outer margin
par(oldpar)
# 1. Load the data
df <- read.csv("protocell_sim_prueba.csv")
n_total <- nrow(df)
sixtysix <- floor(n_total / 3)
df_short <- df[1:sixtysix, ]
# 2. Fit the linear model (Growth Rate alpha)
# We model log_volume as a function of time
myAdditive <- lm(volume ~ time, data = df_short)
# 3. View the summary (Alpha, R^2, and p-values)
summary(myAdditive)
# 2. Fit the linear model (Growth Rate alpha)
# We model log_volume as a function of time
myAdditive <- lm(log_volume ~ time, data = df_short)
# 3. View the summary (Alpha, R^2, and p-values)
summary(myAdditive)
# 4. The "Magic" Diagnostics
# This creates the 2x2 grid you remember
oldpar <- par(oma=c(0,0,3,0), mfrow=c(2,2))
plot(myAdditive)
df_short <- df[sixtysix:n_total, ]
# 2. Fit the linear model (Growth Rate alpha)
# We model log_volume as a function of time
myAdditive <- lm(log_volume ~ time, data = df_short)
# 3. View the summary (Alpha, R^2, and p-values)
summary(myAdditive)
# 4. The "Magic" Diagnostics
# This creates the 2x2 grid you remember
oldpar <- par(oma=c(0,0,3,0), mfrow=c(2,2))
plot(myAdditive)
n_total <- nrow(df)
sixtysix <- floor(n_total / 5)
df_short <- df[sixtysix:n_total, ]
# 2. Fit the linear model (Growth Rate alpha)
# We model log_volume as a function of time
myAdditive <- lm(log_volume ~ time, data = df_short)
# 3. View the summary (Alpha, R^2, and p-values)
summary(myAdditive)
# 4. The "Magic" Diagnostics
# This creates the 2x2 grid you remember
oldpar <- par(oma=c(0,0,3,0), mfrow=c(2,2))
plot(myAdditive)
n_total
sixtysix
sixtysix <- floor(n_total / 2)
df_short <- df[sixtysix:n_total, ]
# 2. Fit the linear model (Growth Rate alpha)
# We model log_volume as a function of time
myAdditive <- lm(log_volume ~ time, data = df_short)
# 3. View the summary (Alpha, R^2, and p-values)
summary(myAdditive)
# 4. The "Magic" Diagnostics
# This creates the 2x2 grid you remember
oldpar <- par(oma=c(0,0,3,0), mfrow=c(2,2))
plot(myAdditive)
